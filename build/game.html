<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />

    <link rel="stylesheet" type="text/css" href="game.css">

    <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
    <script src="https://code.createjs.com/easeljs-0.8.2.min.js"></script>

    <title>Card</title>
    <style>
        body {
            margin: 0;
            padding: 0;
        }

        div  {
            height: 100vh;
            width: 100%;
            background-repeat: no-repeat;
            background: -webkit-linear-gradient(290deg, #3023AE, #C96DD8); /* For Safari 5.1 to 6.0 */
            text-align: center;
        }

        h1 {
            margin: 0;
            padding: 20px;
            font-family: Arial;
            color: #ff7700;
        }
    </style>

    <script>
        function init() {

            function getArc(startAngle, length, color) {
                var width = 10;
                var diamiter = 100;

                var arc = new createjs.Shape();

                arc.graphics.setStrokeStyle(width);
                arc.graphics.s(color);

                var startAngle = startAngle * Math.PI/180;
                var endAngle = startAngle + length * Math.PI/180;
                arc.graphics.arc(0, 0, diamiter, startAngle, endAngle);

                arc.x = stage.canvas.width/2;
                arc.y = stage.canvas.height/2;

                return arc;
            }

            function getTargetSize() {
                switch (level) {
                    case 1:
                        return 85;
                    case 2:
                        return 75;
                    case 3:
                        return 65;
                    case 4:
                        return 55;
                    case 5:
                        return 50;
                    case 6:
                        return 45;
                    case 7:
                        return 40;
                    case 8:
                        return 35;
                    case 9:
                        return 30;
                    case 10:
                        return 25;
                }
            }

            var level = 1;

            var stage = new createjs.Stage("game");

            var text = new createjs.Text(level, "40px Arial", "#ff7700");
            var bounds = text.getBounds();
                text.x = stage.canvas.width/2 - bounds.width/2;
                text.y = stage.canvas.height/2 - bounds.height/2;
                text.textBaseline = "top";
            stage.addChild(text);

            var track = getArc(0, 360, createjs.Graphics.getRGB(66, 147, 33));
            stage.addChild(track);

            var targetSize= getTargetSize();
            var target = getArc(0, targetSize, createjs.Graphics.getRGB(255, 255, 255));
            target.rotation = Math.floor(Math.random() * 360);
            stage.addChild(target);

            var playerSize = 45;
            var player = getArc(0, playerSize, createjs.Graphics.getRGB(245, 81, 95));
            stage.addChild(player);

            function setTargetSize() {
                stage.removeChild(target);

                targetSize = getTargetSize();
                target = getArc(0, targetSize, createjs.Graphics.getRGB(255, 255, 255));
                target.rotation = Math.floor(Math.random() * 360);
                stage.addChild(target);

                stage.setChildIndex(player, stage.getNumChildren()-1)
            }

            function nextLevel() {
                level++;
                if (level > 10) level = 10;
                setTargetSize();
                text.set({text: level})
                var bounds = text.getBounds();
                    text.x = stage.canvas.width/2 - bounds.width/2;
                    text.y = stage.canvas.height/2 - bounds.height/2;
            }

            function restartLevel() {
                setTargetSize();
            }

            function youAreWinner() {
                alert("Hand back to android");
            }

            createjs.Ticker.addEventListener("tick", function() {
                player.rotation += 10;

                if (player.rotation > 360) {
                    player.rotation = 0;
                }

                stage.update();
            });

            document.addEventListener("click", function(event) {
                var playerPositionStart = player.rotation - playerSize/2;
                var playerPositionEnd = player.rotation + playerSize/2;

                var targetPositionStart = target.rotation - targetSize/2;
                var targetPositionEnd = target.rotation + targetSize/2;

                if (targetPositionStart < 0) {
                    targetPositionStart+=360
                }

                if (playerPositionStart < 0) {
                    playerPositionStart+=360
                }

                console.log('player is: ' + playerPositionStart + ' and ' + playerPositionEnd);
                console.log('Target is: ' + targetPositionStart + ' and ' + targetPositionEnd);

                if ((playerPositionEnd > targetPositionStart && playerPositionStart < targetPositionEnd)) {
                    console.log('Winner');
                    if (level < 10) {
                        nextLevel();
                    } else {
                        youAreWinner();
                    }

                } else {
                    console.log('lose');
                    restartLevel();
                }
            });
        }
    </script>
  </head>
  <body>
    <div>
        <h1>Tap when the shapes meet</h1>
        <canvas id="game" width="320" height="320"></canvas>
    </div>
    <script>
        init(1);
    </script>
  </body>
</html>
